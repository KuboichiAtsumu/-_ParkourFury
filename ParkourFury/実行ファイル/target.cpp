//==============================================================================================================================================
//
// ターゲットに関する処理
// Author : Atsumu Kuboichi
//
//==============================================================================================================================================

//===========================================================================================================
// ヘッダーインクルード
//===========================================================================================================
#include "target.h"

//===========================================================================================================
// コンストラクタ
//===========================================================================================================
CTarget::CTarget(int nPriority) : CBillboard(nPriority)
{
	//メンバ変数初期化
	m_pTargetObj = nullptr;//対象オブジェクト
}

//===========================================================================================================
// デストラクタ
//===========================================================================================================
CTarget::~CTarget()
{
}

//===========================================================================================================
// 初期化処理
//===========================================================================================================
HRESULT CTarget::Init()
{
	//テクスチャ生成
	CTexture* pTex = CTexture::GetInstance();//取得
	BindTexture(pTex->GetAddress(CTag::TAG::EFFECT, 1));//設定

	//パラメータ設定
	SetSize(SIZE);//サイズ

	//基底クラス初期化処理
	if (FAILED(CBillboard::Init()))
	{
		return E_FAIL;
	}

	return S_OK;
}

//===========================================================================================================
// 終了処理
//===========================================================================================================
void CTarget::Uninit()
{
	//基底クラス終了処理
	CBillboard::Uninit();
}

//===========================================================================================================
// 解放処理
//===========================================================================================================
void CTarget::Release()
{
	//対象オブジェクトをnullptrにする
	m_pTargetObj = nullptr;

	//基底クラス解放処理
	CBillboard::Release();
}

//===========================================================================================================
// 更新処理
//===========================================================================================================
void CTarget::Update()
{
	//対象オブジェクトとの距離計算処理
	CalculationRange();

	//基底クラス更新処理
	CBillboard::Update();
}

//===========================================================================================================
// 描画処理
//===========================================================================================================
void CTarget::Draw()
{
	//基底クラス描画処理
	CBillboard::Draw();
}

//===========================================================================================================
// 生成処理
//===========================================================================================================
CTarget* CTarget::Create(D3DXVECTOR3 pos, CObject3D* pObj)
{
	//メモリを動的確保
	CTarget* pTarget = NEW CTarget(static_cast<int>(Category::EFFECT));

	//ターゲット情報が存在する場合
	if (pTarget != nullptr)
	{
		//パラメータ設定
		pTarget->SetPos(pos);//座標
		pTarget->m_pTargetObj = pObj;//対象オブジェクトのポインタ

		//初期化処理
		pTarget->Init();
	}

	return pTarget;
}

//===========================================================================================================
// 対象オブジェクトとの距離計算処理
//===========================================================================================================
void CTarget::CalculationRange()
{
	//目標の位置までの差分を求める
	D3DXVECTOR3 Difference = GetPos() - m_pTargetObj->GetPos();

	//目標の位置に達した場合
	if (abs(Difference.x) < 1.0f &&
		abs(Difference.y) < 1.0f &&
		abs(Difference.z) < 1.0f)
	{
		//終了処理
		Uninit();
	}
}
